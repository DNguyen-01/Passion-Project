<!DOCTYPE html>
<html>
<head>
    <h1>Cigar Friend</h1>
<body>

<h3>Manufacturers</h3>
<select id="manufacturers"></select>
<br>
<br>
<h3>Country</h3>
<select id="country"></select>
<br>
<br>
<h3>Strength</h3>
<select id="strength"></select>

<button onclick="fetchCigars()">Search</button>
<br>
<table>
    <tr>
        <thead>
        <th>Cigar</th>
        <th>Manufacturer</th>
        <th>Country</th>
        <th>Strength</th>
        </thead>
        </tr>
        <tbody id="resultsTable">
</table>


<!--<label>Choose a brand:</label>-->

<script>
const brands = async() => {
  let headers = new Headers();
  headers.append('Accept', 'application/json');

  fetch('http://localhost:8083/brand-controller/brands', {
    method: 'GET',
    headers: headers
  }).then(response => response.json()).then( json => {
    manufacturer_payload = json;
    for (var i = 0; i < manufacturer_payload.length; i++) {
      var option = document.createElement("OPTION");
      option.innerHTML = manufacturer_payload[i].name;
      option.value = manufacturer_payload[i].id;
      manufacturers.options.add(option);
      console.log("added option: " + JSON.stringify(option, null, 2));
    }
  }
).catch(error =>
    console.log('An error occurred: ' + error.message)
  );
}

const fetchCountry = async() => {
  let headers = new Headers();
  headers.append('Accept', 'application/json');

  fetch('http://localhost:8083/country-controller/countries', {
    method: 'GET',
    headers: headers
  }).then(response => response.json()).then( json => {
    var country_payload = json;
    for (var i = 0; i < country_payload.length; i++) {
      var option = document.createElement("OPTION");
      option.innerHTML = country_payload[i].name;
      option.value = country_payload[i].id;
      country.options.add(option);
      console.log("added option: " + JSON.stringify(option, null, 2));
    }
  }
).catch(error =>
    console.log('An error occurred: ' + error.message)
  );
}

const fetchStrength = async() => {
  let headers = new Headers();
  headers.append('Accept', 'application/json');

  fetch('http://localhost:8083/strength-controller/strength', {
    method: 'GET',
    headers: headers
  }).then(response => response.json()).then( json => {
    var strength_payload = json;
    for (var i = 0; i < strength_payload.length; i++) {
      var option = document.createElement("OPTION");
      option.innerHTML = strength_payload[i].name;
      option.value = strength_payload[i].id;
      strength.options.add(option);
      console.log("added option: " + JSON.stringify(option, null, 2));
    }
  }
).catch(error =>
    console.log('An error occurred: ' + error.message)
  );
}

const fetchCigars = async() => {
  var resultsBody = document.getElementById("resultsTable");
  resultsBody.innerHTML = "";
  let headers = new Headers();
  headers.append('Accept', 'application/json');
   var url = new URL('http://localhost:8083/cigar-controller/cigar')
   console.log("countryId: " + country.options[country.selectedIndex].value);
   var param = {countryId: country.options[country.selectedIndex].value,
   strengthId: strength.options[strength.selectedIndex].value, brandId: manufacturers.options[manufacturers.selectedIndex].value};
   url.search = new URLSearchParams(param).toString();
  fetch(url, {
    method: 'GET',
    headers: headers
  }).then(response => response.json()).then( json => {
    var cigar_payload = json;
    var table = document.getElementById('resultsTable');
    for (var i = 0; i < cigar_payload.length; i++) {
      var row = table.insertRow();
      var nameCell = row.insertCell(0);
      var manufacturerCell = row.insertCell(1);
      var countryCell = row.insertCell(2);
      var strengthCell = row.insertCell(3);

      nameCell.innerHTML = cigar_payload[i].name;
      manufacturerCell.innerHTML = cigar_payload[i].brand.name;
      countryCell.innerHTML = cigar_payload[i].country.name;
      strengthCell.innerHTML = cigar_payload[i].strength.name;
    }
  }
).catch(error =>
    console.log('An error occurred: ' + error.message)
  );
}

<!--loads first at HTML loading -->
var manufacturer_payload;
document.addEventListener('DOMContentLoaded', function(){
    brands();
    fetchCountry();
    fetchStrength();
    setTimeout(fetchCigars, 5000);
}, false);
</script>

</head>
</html>